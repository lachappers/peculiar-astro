---
import { getAllTaxonomy, getTaxonomy } from "@utils/taxonomyParser";
import { humanize, slugify, pluralize } from "@utils/textConverter";

const { sidebarCountFilters, sidebarFilters, collection } = Astro.props;
---

<aside
  class="flex w-full flex-col gap-4 px-4 lg:w-1/3 lg:basis-auto"
  aria-label=""
>
  <!-- sidebarCountFilters -->
  {
    sidebarCountFilters &&
      sidebarCountFilters.map(async (filter: any) => {
        const categories = await getAllTaxonomy(collection, filter);
        const entries = Object.entries(categories);
        // console.log(entries);
        return (
          <section class=" rounded border-[3px] border-[--font-color] bg-[--secondary-background]  p-4">
            <h2 class="mb-2 text-xl capitalize">
              {pluralize(entries.length, filter)}
            </h2>
            <ul class="flex flex-col  text-base">
              {entries.map(([k, v]) => (
                <li class="">
                  <a
                    class="filter-item flex items-center justify-between rounded-md p-1 hover:bg-[--primary-background]"
                    href={`/blog/${slugify(filter)}/${slugify(k)}`}
                  >
                    {humanize(k)}{" "}
                    <span class="rounded bg-[--neutral-background] p-1 px-2">
                      {v}
                    </span>
                  </a>
                </li>
              ))}
            </ul>
          </section>
        );
      })
  }

  {
    sidebarFilters &&
      sidebarFilters.map(async (filter: any) => {
        const entries = await getTaxonomy(collection, filter);
        return (
          <section class=" rounded border-[3px] border-[--font-color] bg-[--secondary-background]  p-4">
            <h2 class=" mb-2 text-xl capitalize">
              {pluralize(entries.length, filter)}
            </h2>
            <ul class="flex flex-wrap gap-2  px-4 text-base">
              {entries.map((tag: any) => {
                return (
                  <li class="inline-block">
                    <a
                      class="filter-item   m-1 block rounded bg-[--neutral-background] px-3 py-1 hover:bg-[--primary-background] "
                      href={`/blog/${slugify(filter)}/${slugify(tag)}`}
                    >
                      {humanize(tag)}
                    </a>
                  </li>
                );
              })}
            </ul>
          </section>
        );
      })
  }
</aside>
